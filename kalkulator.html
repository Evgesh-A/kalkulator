<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kalkulator budowy domu</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, sans-serif; }
    body { padding: 20px; background: #f9f9f9; color: #333; }
    h1 { text-align: center; margin-bottom: 20px; color: #2c3e50; }
    .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin: 15px 0; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background-color: #f1f1f1; }
    input { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; }
    input[type="number"] { text-align: right; }
    .actions button {
      padding: 6px 10px;
      margin: 2px;
      border: none;
      border-radius: 4px;
      background: #e74c3c;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    .actions button:hover { background: #c0392b; }
    .btn-group {
      text-align: center;
      margin: 20px 0;
    }
    .btn-group button {
      padding: 10px 20px;
      margin: 0 10px;
      border: none;
      border-radius: 5px;
      background: #3498db;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    .btn-group button:hover { background: #2980b9; }
    .total-row {
      font-weight: bold;
      background: #f8f9fa;
    }
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr { display: block; }
      thead tr { position: absolute; top: -9999px; left: -9999px; }
      tr { border: 1px solid #ccc; margin-bottom: 10px; padding: 10px; }
      td { text-align: right; padding-left: 50%; position: relative; }
      td:before {
        content: attr(data-label);
        position: absolute;
        left: 10px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        font-weight: bold;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Kalkulator kosztÃ³w budowy domu</h1>
    <table id="costTable">
      <thead>
        <tr>
          <th>Kategoria</th>
          <th>Poz. / opis</th>
          <th>IloÅ›Ä‡</th>
          <th>Cena jednostkowa (PLN)</th>
          <th>Jednostka</th>
          <th>WartoÅ›Ä‡ (PLN)</th>
          <th>Akcje</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- Wiersze bÄ™dÄ… Å‚adowane z localStorage lub dodawane -->
      </tbody>
      <tfoot>
        <tr class="total-row">
          <td colspan="5" style="text-align: right;">SUMARYCZNY KOSZT:</td>
          <td id="total">0.00 PLN</td>
          <td></td>
        </tr>
      </tfoot>
    </table>

    <div class="btn-group">
      <button onclick="addRow()">âž• Dodaj pozycjÄ™</button>
      <button onclick="exportToPDF()">ðŸ“„ Eksport do PDF</button>
      <button onclick="exportToExcel()">ðŸ“Š Eksport do XLSX</button>
    </div>
  </div>

  <!-- External libraries (embedded via CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    // Initialize jsPDF
    const { jsPDF } = window.jspdf;

    let rowId = 0;

    // Load data from localStorage on start
    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('kalkulatorData');
      if (saved) {
        const data = JSON.parse(saved);
        data.forEach(item => {
          addRow(item);
        });
      } else {
        addRow(); // at least one empty row
      }
      recalc();
    });

    function addRow(data = null) {
      const tbody = document.getElementById('tableBody');
      const row = tbody.insertRow();
      const id = rowId++;
      row.dataset.id = id;

      const category = data?.category || '';
      const description = data?.description || '';
      const qty = data?.qty || '';
      const price = data?.price || '';
      const unit = data?.unit || '';

      row.innerHTML = `
        <td data-label="Kategoria"><input type="text" placeholder="Kategoria" value="${category}" oninput="saveData()"></td>
        <td data-label="Opis"><input type="text" placeholder="Opis" value="${description}" oninput="saveData()"></td>
        <td data-label="IloÅ›Ä‡"><input type="number" min="0" step="0.01" value="${qty}" oninput="recalc()"></td>
        <td data-label="Cena"><input type="number" min="0" step="0.01" value="${price}" oninput="recalc()"></td>
        <td data-label="Jednostka"><input type="text" placeholder="szt., mÂ²..." value="${unit}" oninput="saveData()"></td>
        <td data-label="WartoÅ›Ä‡" class="value">0.00</td>
        <td data-label="Akcje" class="actions"><button onclick="removeRow(this)">UsuÅ„</button></td>
      `;
      recalc();
      saveData();
    }

    function removeRow(btn) {
      btn.closest('tr').remove();
      recalc();
      saveData();
    }

    function recalc() {
      let total = 0;
      document.querySelectorAll('#tableBody tr').forEach(row => {
        const qtyInput = row.cells[2].querySelector('input');
        const priceInput = row.cells[3].querySelector('input');
        const qty = parseFloat(qtyInput?.value) || 0;
        const price = parseFloat(priceInput?.value) || 0;
        const value = qty * price;
        row.cells[5].textContent = value.toFixed(2);
        total += value;
      });
      document.getElementById('total').textContent = total.toFixed(2) + ' PLN';
    }

    function saveData() {
      const rows = [];
      document.querySelectorAll('#tableBody tr').forEach(row => {
        const inputs = row.querySelectorAll('input');
        rows.push({
          category: inputs[0]?.value || '',
          description: inputs[1]?.value || '',
          qty: inputs[2]?.value || '',
          price: inputs[3]?.value || '',
          unit: inputs[4]?.value || ''
        });
      });
      localStorage.setItem('kalkulatorData', JSON.stringify(rows));
    }

    function exportToPDF() {
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text('Kalkulator kosztÃ³w budowy domu', 14, 20);

      const tableData = [];
      document.querySelectorAll('#tableBody tr').forEach(row => {
        const cells = row.querySelectorAll('td');
        const rowData = [
          cells[0].querySelector('input')?.value || '',
          cells[1].querySelector('input')?.value || '',
          parseFloat(cells[2].querySelector('input')?.value) || 0,
          parseFloat(cells[3].querySelector('input')?.value) || 0,
          cells[4].querySelector('input')?.value || '',
          parseFloat(cells[5].textContent) || 0
        ];
        tableData.push(rowData);
      });

      const total = document.getElementById('total').textContent;

      doc.autoTable({
        startY: 30,
        head: [['Kategoria', 'Opis', 'IloÅ›Ä‡', 'Cena jedn. (PLN)', 'Jednostka', 'WartoÅ›Ä‡ (PLN)']],
        body: tableData,
        theme: 'grid',
        headStyles: { fillColor: [52, 152, 219] }
      });

      const finalY = doc.lastAutoTable.finalY + 10;
      doc.setFontSize(14);
      doc.text(`Suma: ${total}`, 14, finalY);

      doc.save('kalkulator_budowa.pdf');
    }

    function exportToExcel() {
      const ws_data = [
        ['Kategoria', 'Opis', 'IloÅ›Ä‡', 'Cena jedn. (PLN)', 'Jednostka', 'WartoÅ›Ä‡ (PLN)']
      ];

      document.querySelectorAll('#tableBody tr').forEach(row => {
        const inputs = row.querySelectorAll('input');
        const value = parseFloat(row.cells[5].textContent) || 0;
        ws_data.push([
          inputs[0]?.value || '',
          inputs[1]?.value || '',
          parseFloat(inputs[2]?.value) || '',
          parseFloat(inputs[3]?.value) || '',
          inputs[4]?.value || '',
          value
        ]);
      });

      const total = document.getElementById('total').textContent;
      ws_data.push(['', '', '', '', 'SUMA:', total]);

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      XLSX.utils.book_append_sheet(wb, ws, 'Koszty');
      XLSX.writeFile(wb, 'kalkulator_budowa.xlsx');
    }
  </script>
</body>
</html>