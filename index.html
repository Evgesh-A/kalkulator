<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –¥–æ–º–∞</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, sans-serif; }
    body { padding: 20px; background: #f9f9f9; color: #333; }
    h1 { text-align: center; margin: 10px 0; color: #2c3e50; font-size: 24px; }
    h2 { text-align: center; margin: 5px 0; font-size: 18px; color: #555; }
    .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin: 15px 0; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background-color: #f1f1f1; }
    input { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; }
    input[type="number"] { text-align: right; }
    .actions button {
      padding: 6px 10px;
      margin: 2px;
      border: none;
      border-radius: 4px;
      background: #e74c3c;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    .actions button:hover { background: #c0392b; }
    .btn-group {
      text-align: center;
      margin: 20px 0;
    }
    .btn-group button {
      padding: 10px 20px;
      margin: 0 10px;
      border: none;
      border-radius: 5px;
      background: #3498db;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    .btn-group button:hover { background: #2980b9; }
    .total-row {
      font-weight: bold;
      background: #f8f9fa;
    }
    .footer-text {
      margin-top: 20px;
      font-size: 14px;
      color: #666;
      line-height: 1.5;
    }
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr { display: block; }
      thead tr { position: absolute; top: -9999px; left: -9999px; }
      tr { border: 1px solid #ccc; margin-bottom: 10px; padding: 10px; }
      td { text-align: right; padding-left: 50%; position: relative; }
      td:before {
        content: attr(data-label);
        position: absolute;
        left: 10px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        font-weight: bold;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –¥–æ–º–∞</h1>
    <h2>–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–±–æ—Ç</h2>
    <p style="text-align:center; margin-bottom:15px; font-style:italic;">–° –µ—ë –ø–æ–º–æ—â—å—é –≤—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å–æ—Å—Ç–∞–≤–∏—Ç–µ —Å–º–µ—Ç—É ‚Äî –≤–µ—Ä—Å–∏—è 1.0 –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç–∞–¥–∏–∏</p>

    <table id="costTable">
      <thead>
        <tr>
          <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
          <th>–ü–æ–∑. / –æ–ø–∏—Å–∞–Ω–∏–µ</th>
          <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
          <th>–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É</th>
          <th>–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è</th>
          <th>–°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- –°—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
      </tbody>
      <tfoot>
        <tr class="total-row">
          <td colspan="5" style="text-align: right;">–ò–¢–û–ì–û–í–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:</td>
          <td id="total">0.00 —Ä—É–±.</td>
          <td></td>
        </tr>
      </tfoot>
    </table>

    <div class="btn-group">
      <button onclick="addRow()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é</button>
      <button onclick="exportToPDF()">üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF</button>
      <button onclick="exportToExcel()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ XLSX</button>
    </div>

    <div class="footer-text">
      <p>–ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º—É –æ–Ω–ª–∞–π–Ω-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É –≤—ã –º–æ–∂–µ—Ç–µ –±–µ–∑–≤–æ–∑–º–µ–∑–¥–Ω–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Å–º–µ—Ç—É —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –¥–æ–º–∞. –ü–æ–¥—Ä—è–¥—á–∏–∫ –º–æ–∂–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç—á—ë—Ç –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º —Ä–∞–±–æ—Ç–∞–º.</p>
      <p>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ü–ö –∏ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —É–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—É –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–º–µ—Ç—É, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF –∏–ª–∏ XLSX.</p>
      <p><strong>–í—Å–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –æ—Å—Ç–∞—é—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.</strong> –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç –Ω–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</p>
    </div>
  </div>

  <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    const { jsPDF } = window.jspdf;
    let rowId = 0;

    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('kalkulatorData');
      if (saved) {
        const data = JSON.parse(saved);
        data.forEach(item => addRow(item));
      } else {
        addRow();
      }
      recalc();
    });

    function addRow(data = null) {
      const tbody = document.getElementById('tableBody');
      const row = tbody.insertRow();
      const category = data?.category || '';
      const description = data?.description || '';
      const qty = data?.qty || '';
      const price = data?.price || '';
      const unit = data?.unit || '';

      row.innerHTML = `
        <td data-label="–ö–∞—Ç–µ–≥–æ—Ä–∏—è"><input type="text" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è" value="${category}" oninput="saveData()"></td>
        <td data-label="–û–ø–∏—Å–∞–Ω–∏–µ"><input type="text" placeholder="–ü–æ–∑. / –æ–ø–∏—Å–∞–Ω–∏–µ" value="${description}" oninput="saveData()"></td>
        <td data-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ"><input type="number" min="0" step="0.01" value="${qty}" oninput="recalc()"></td>
        <td data-label="–¶–µ–Ω–∞"><input type="number" min="0" step="0.01" value="${price}" oninput="recalc()"></td>
        <td data-label="–ï–¥. –∏–∑–º."><input type="text" placeholder="—à—Ç., –º¬≤..." value="${unit}" oninput="saveData()"></td>
        <td data-label="–°—Ç–æ–∏–º–æ—Å—Ç—å" class="value">0.00</td>
        <td data-label="–î–µ–π—Å—Ç–≤–∏—è" class="actions"><button onclick="removeRow(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
      `;
      recalc();
      saveData();
    }

    function removeRow(btn) {
      btn.closest('tr').remove();
      recalc();
      saveData();
    }

    function recalc() {
      let total = 0;
      document.querySelectorAll('#tableBody tr').forEach(row => {
        const qty = parseFloat(row.cells[2].querySelector('input').value) || 0;
        const price = parseFloat(row.cells[3].querySelector('input').value) || 0;
        const value = qty * price;
        row.cells[5].textContent = value.toFixed(2);
        total += value;
      });
      document.getElementById('total').textContent = total.toFixed(2) + ' —Ä—É–±.';
    }

    function saveData() {
      const rows = [];
      document.querySelectorAll('#tableBody tr').forEach(row => {
        const inputs = row.querySelectorAll('input');
        rows.push({
          category: inputs[0]?.value || '',
          description: inputs[1]?.value || '',
          qty: inputs[2]?.value || '',
          price: inputs[3]?.value || '',
          unit: inputs[4]?.value || ''
        });
      });
      localStorage.setItem('kalkulatorData', JSON.stringify(rows));
    }

    function exportToPDF() {
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –¥–æ–º–∞', 14, 20);
      const tableData = [];
      document.querySelectorAll('#tableBody tr').forEach(row => {
        const inputs = row.querySelectorAll('input');
        const value = parseFloat(row.cells[5].textContent) || 0;
        tableData.push([
          inputs[0]?.value || '',
          inputs[1]?.value || '',
          parseFloat(inputs[2]?.value) || '',
          parseFloat(inputs[3]?.value) || '',
          inputs[4]?.value || '',
          value
        ]);
      });
      doc.autoTable({
        startY: 30,
        head: [['–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–û–ø–∏—Å–∞–Ω–∏–µ', '–ö–æ–ª-–≤–æ', '–¶–µ–Ω–∞ –∑–∞ –µ–¥.', '–ï–¥. –∏–∑–º.', '–°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)']],
        body: tableData,
        theme: 'grid',
        headStyles: { fillColor: [52, 152, 219] }
      });
      const finalY = doc.lastAutoTable.finalY + 10;
      doc.setFontSize(14);
      doc.text(`–ò—Ç–æ–≥–æ: ${document.getElementById('total').textContent}`, 14, finalY);
      doc.save('—Å–º–µ—Ç–∞_—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ.pdf');
    }

    function exportToExcel() {
      const ws_data = [
        ['–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–û–ø–∏—Å–∞–Ω–∏–µ', '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', '–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É', '–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è', '–°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)']
      ];
      document.querySelectorAll('#tableBody tr').forEach(row => {
        const inputs = row.querySelectorAll('input');
        const value = parseFloat(row.cells[5].textContent) || 0;
        ws_data.push([
          inputs[0]?.value || '',
          inputs[1]?.value || '',
          parseFloat(inputs[2]?.value) || '',
          parseFloat(inputs[3]?.value) || '',
          inputs[4]?.value || '',
          value
        ]);
      });
      ws_data.push(['', '', '', '', '–ò–¢–û–ì–û:', document.getElementById('total').textContent]);
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      XLSX.utils.book_append_sheet(wb, ws, '–°–º–µ—Ç–∞');
      XLSX.writeFile(wb, '—Å–º–µ—Ç–∞_—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ.xlsx');
    }
  </script>
</body>
</html>
